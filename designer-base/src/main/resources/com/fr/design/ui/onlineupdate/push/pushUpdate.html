<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Push Update</title>
    <link rel="stylesheet" href="emb:/com/fr/web/ui/fineui.min.css"/>
    <script src="emb:/com/fr/web/ui/fineui.min.js"></script>
    <style>
        .title {
            font-size: 30px;
        }
        .desc {
            margin-top: 35px;
        }
        .moreInfo {
            margin-top: 15px;
        }
        .buttonGroup {
            margin-top: 35px;
        }
        .button-ignore {

        }
        body {
            padding-left: 30px;
            padding-top: 30px;
            color: white;
        }
    </style>
</head>
<body>
    <script>
        // var EVENT_POPULATE = "EVENT_POPULATE";

        // var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        //
        // var observer = new MutationObserver(function(mutations) {
        //     mutations.forEach(function(mutation) {
        //         if (mutation.type === "attributes" && window.Pool) {
        //             console.log("attributes changed");
        //             window.fireEvent(EVENT_POPULATE);
        //         }
        //     });
        // });
        //
        // observer.observe(window, {
        //     attributes: true //configure it to listen to attribute changes
        // });




        window.addEventListener("load", function (ev) {
            // alert(window.Pool.data);
            // todo: 开发临时方案
            // setTimeout(function () {

                console.log(window.Pool.data);
                var title = BI.createWidget({
                    type: "bi.vertical",
                    items: [
                        {
                            type: "bi.label",
                            text: "发现新版本",
                            cls: "title",
                            textAlign: "left"
                        },
                        {
                            type: "bi.label",
                            text: Pool.data.getVersion(),
                            textAlign: "left"
                        }
                    ]
                });

                var desc = BI.createWidget({
                    type: "bi.vertical",
                    cls: "desc",
                    items: [
                        {
                            type: "bi.label",
                            // text: "1) xxx",
                            text: Pool.data.getContent(),
                            textAlign: "left"
                        }
                        // {
                        //     type: "bi.label",
                        //     text: "2) ldsnvls df",
                        //     textAlign: "left"
                        // }
                    ]
                });

                var moreInfo = BI.createWidget({
                    type: "bi.text_button",
                    text: "更多信息",
                    cls: "moreInfo",
                    textAlign: "left"
                });

                var buttonGroup = BI.createWidget({
                    type: 'bi.left',
                    cls: "buttonGroup",
                    items: [
                        {
                            type: 'bi.button',
                            text: '立即更新',
                            level: 'common',
                            height: 30,
                            handler: function() {
                                Pool.data.updateNow();
                            }
                        },
                        {
                            el: {
                                type: 'bi.button',
                                text: '下次启动提醒我',
                                level: 'ignore',
                                height: 30,
                                handler: function() {
                                    Pool.data.remindNextTime();
                                }
                            },
                            lgap: 10
                        },
                        {
                            el: {
                                type: 'bi.button',
                                text: '跳过此版本',
                                level: 'ignore',
                                height: 30,
                                handler: function() {
                                    Pool.data.skipThisVersion();
                                }
                            },
                            lgap: 10
                        }
                    ]
                });

                BI.createWidget({
                    type:"bi.vertical",
                    element: "body",
                    cls: "container",
                    items: [
                        title,
                        desc,
                        moreInfo,
                        buttonGroup
                    ]
                });

                $(".container").css("background", "url(" + Pool.data.getBackgroundUrl() + ")");
                $(".button-ignore").css({
                    "background-color": "white",
                    "border": "1px solid white"
                });



            // }, 2000);



            // setTimeout(function() {
            //     // alert(Pool.data);
            //     alert(Pool.data.getName() + " " + Pool.data.getAge());
            // }, 2000);

            // Pool.update = function () {
            //     Pool.data.setAge(12);
            //     Pool.data.setName("Tom");
            //     return Pool.data;
            // };
        });

    </script>
</body>
</html>